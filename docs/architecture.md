# システム構成図

## 概要

本システムは、Azure上に構築されたRAG（Retrieval-Augmented Generation）型のナレッジ検索プラットフォームです。

## アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────────┐
│                        クライアント                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              React SPA (チャット型UI)                    │   │
│  │   - 自然言語検索インターフェース                          │   │
│  │   - 検索結果表示                                         │   │
│  │   - 管理画面                                             │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Azure App Service                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              FastAPI Backend                             │   │
│  │   - 認証・認可 (JWT)                                     │   │
│  │   - 検索API                                              │   │
│  │   - ドキュメント管理API                                  │   │
│  │   - 管理API                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
          │              │              │              │
          │              │              │              │
          ▼              ▼              ▼              ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│Azure OpenAI  │ │Azure AI      │ │Azure Blob    │ │SQLite/       │
│              │ │Search        │ │Storage       │ │PostgreSQL    │
│- GPT-4       │ │              │ │              │ │              │
│- Embeddings  │ │- ベクトル検索 │ │- ドキュメント │ │- ユーザー    │
│- RAG応答生成 │ │- セマンティック│ │  ストレージ   │ │- 履歴        │
│              │ │  検索        │ │              │ │- メタデータ   │
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
```

## コンポーネント詳細

### フロントエンド (React + TypeScript)

| コンポーネント | 説明 |
|--------------|------|
| Search.tsx | チャット形式の検索UI |
| Admin.tsx | ドキュメント管理画面 |
| Login.tsx | ログイン画面 |
| Layout.tsx | 共通レイアウト |

### バックエンド (FastAPI + Python)

| モジュール | 説明 |
|-----------|------|
| main.py | APIエンドポイント定義 |
| auth.py | 認証・認可処理 |
| services/search_service.py | RAG検索ロジック |
| services/document_processor.py | ドキュメント解析 |
| services/azure_services.py | Azure サービス連携 |

### Azureサービス

| サービス | 用途 |
|---------|------|
| Azure OpenAI | GPT-4による回答生成、text-embedding-ada-002によるベクトル化 |
| Azure AI Search | ハイブリッド検索（キーワード + ベクトル + セマンティック） |
| Azure Blob Storage | ドキュメントファイルの保存 |
| Azure App Service | アプリケーションホスティング |

## データフロー

### 検索フロー

```
1. ユーザーが自然言語で質問を入力
   例: 「野菜炒めの離水防止」

2. バックエンドで質問をベクトル化
   Azure OpenAI Embeddings API

3. ハイブリッド検索を実行
   Azure AI Search
   - キーワード検索
   - ベクトル類似度検索
   - セマンティック検索（リランキング）

4. 検索結果をコンテキストとしてRAG応答を生成
   Azure OpenAI GPT-4

5. 検索結果と回答をユーザーに返す
```

### ドキュメント登録フロー

```
1. ユーザーがファイルをアップロード
   Excel/Word/PowerPoint/PDF/画像

2. ファイル名からメタデータを抽出
   [アプリケーション]_[課題感]_[使用原料]_[顧客名]_[試作ID]

3. ドキュメントからテキストを抽出
   DocumentProcessor

4. テキストをチャンクに分割
   chunk_size=1000, overlap=200

5. 各チャンクをベクトル化
   Azure OpenAI Embeddings

6. Azure AI Searchにインデックス登録

7. Azure Blob Storageにファイル保存
```

## セキュリティ

- HTTPS通信
- JWT認証
- ユーザー名・パスワード認証
- CORS設定

## 拡張性

- 新しいドキュメント形式への対応が容易
- 検索インデックスのスケーリング可能
- マルチテナント対応の設計
